angular.module("ngSecured",["ui.router"]).run(["ngSecured",function(){}]),angular.module("ngSecured").directive("asRole",["ngSecured","$animate",function(a,b){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,g){function h(a){var b=a[0],c=a[a.length-1];if(b===c)return angular.element(b);var d=b,e=[d];do{if(d=d.nextSibling,!d)break;e.push(d)}while(d!==c);return angular.element(e)}function i(){a.includesRole(l)?k||(k=c.$new(),g(k,function(a){a[a.length++]=document.createComment(" end asRole: "+e.asRole+" "),j={clone:a},b.enter(a,d.parent(),d)})):(j&&(b.leave(h(j.clone)),j=null),k&&(k.$destroy(),k=null))}var j,k,l;c.$watch(function(){return e.asRole},function(a){l=a,i()}),c.$watch(function(){return a.getRoles()},i)}}}]),angular.module("ngSecured").provider("ngSecured",["$stateProvider",function(a){var b="private__ngSecured",c={BASE_STATE:b,NOT_AUTHENTICATED:b+".notAuthenticated",NOT_AUTHORIZED:b+".notAuthorized"},d={loginState:c.NOT_AUTHENTICATED,unAuthorizedState:c.NOT_AUTHORIZED,isAuthenticated:function(){return!1},postLoginState:c.NOT_AUTHENTICATED,fetchRoles:void 0};a.state(c.BASE_STATE,{}),a.state(c.NOT_AUTHENTICATED,{views:{"@":{template:"please login to see this page."}}}),a.state(c.NOT_AUTHORIZED,{views:{"@":{template:"You are not authorized to see this page."}}}),this.secure=function(a){angular.extend(d,a)},this.$get=["$rootScope","$state","$q","$injector",function(a,b,e,f){function g(){n=d.postLoginState}function h(a,c,e){c.secured&&(k()?c.secured.hasOwnProperty("role")&&(!p||p.indexOf(c.secured.role))&&(a.preventDefault(),b.go(d.unAuthorizedState)):(a.preventDefault(),n=c.name,o=e,b.go(d.loginState)))}function i(){n&&b.go(n,o)}function j(){if(!d.fetchRoles)throw new Error("fetchRoles is not defined");var a=f.invoke(d.fetchRoles);return e.when(a).then(function(a){return a&&m(a),a})}function k(){return f.invoke(d.isAuthenticated)}function l(){return p}function m(a){p=angular.isString(a)?[a]:angular.isArray(a)?a:void 0}var n,o,p;return g(),a.$on("$stateChangeStart",function(a,c,e){d.fetchRoles&&!l()?(a.preventDefault(),j().then(function(){b.go(c,e)})):h(a,c,e)}),{defaultStateNames:c,_initVars:g,login:function(a){if(d.login){var b=e.when(f.invoke(d.login,d,{credentials:a}));return b.then(function(){d.fetchRoles?j().then(function(){i()}):i()}),b}throw new Error("login function must be configured")},isAuthenticated:k,setRoles:m,getRoles:l,includesRole:function(a){return p&&-1!==p.indexOf(a)?!0:!1},fetchingRoles:j}}]}]);